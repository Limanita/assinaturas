<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Assinatura Dinâmica</title>

  <!-- Fontes -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Mulish:wght@400;600&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Mulish', sans-serif; padding: 20px; }
    select { padding: 8px; margin-bottom: 20px; }
    #assinatura table { font-size: 14px; color: #3d3d3d; }
    .contatos { display: flex; flex-direction: column; gap: 4px; margin-top: 16px; }
    .linha-contato { font-size: 14px; color: #3d3d3d; }
    .linha-contato a { text-decoration: none; color: inherit; }
    button { margin-top: 16px; padding: 8px 12px; font-size: 14px; cursor: pointer; }
  </style>
</head>
<body>
  <select id="usuarios">
    <option value="">Selecione seu nome</option>
  </select>

  <div id="assinatura"></div>
  <button id="copyBtn" style="display: none;">Copiar assinatura</button>

  <script>
    // 1) busca usuários
    fetch('https://sheetdb.io/api/v1/2x4ewyobzg0nj')
      .then(res => res.json())
      .then(data => {
        const sel = document.getElementById('usuarios');
        data.forEach(user => {
          const opt = document.createElement('option');
          opt.value = user.Nome;
          opt.textContent = user.Nome;
          opt.dataset.info = JSON.stringify(user);
          sel.appendChild(opt);
        });

        sel.addEventListener('change', function() {
          const info = JSON.parse(this.selectedOptions[0].dataset.info);
          const telefone = info.Telefone || '85 3194-1300';
          const celular  = info.Celular  || '';
          const email    = info.Email    || '';
          const site     = 'www.aprendereditora.com.br';

          const html = `
            <table cellpadding="0" cellspacing="0" border="0" style="font-family: Tahoma;">
              <tbody>
                <tr>
                  <td>
                    <!-- Logo principal hospedada no Imgur -->
                    <img
                      src="https://i.imgur.com/gOyHntN.png"
                      width="200" height="70"
                      style="display:block;object-fit:cover;"
                      alt="Logo Aprender Editora">
                    <div style="height:16px;"></div>
                    <div style="display:flex;gap:12px;justify-content:center;">
                      <a href="https://www.facebook.com/AprenderEditora" style="display:inline-block;background-color:#23c329;border-radius:50%;padding:0;">
                        <img src="https://cdn2.hubspot.net/hubfs/53/tools/email-signature-generator/icons/facebook-icon-dark-2x.png" alt="Facebook" width="24" height="24" style="display:block;border-radius:inherit;">
                      </a>
                      <a href="https://x.com/aprendereditora" style="display:inline-block;background-color:#23c329;border-radius:50%;padding:0;">
                        <img src="https://cdn2.hubspot.net/hubfs/53/tools/email-signature-generator/icons/x-icon-dark-2x.png" alt="X" width="24" height="24" style="display:block;border-radius:inherit;">
                      </a>
                      <a href="https://www.instagram.com/aprendereditora" style="display:inline-block;background-color:#23c329;border-radius:50%;padding:0;">
                        <img src="https://cdn2.hubspot.net/hubfs/53/tools/email-signature-generator/icons/instagram-icon-dark-2x.png" alt="Instagram" width="24" height="24" style="display:block;border-radius:inherit;">
                      </a>
                    </div>
                  </td>
                  <td width="18"></td>
                  <td style="vertical-align:middle;">
                    <h2 style="margin:0;font-size:18px;color:#3d3d3d;">${info.Nome}</h2>
                    <p style="margin:0;font-size:14px;color:#055441;font-weight:600;line-height:22px;">
                      ${info.Cargo}
                    </p>
                    <div style="font-weight:500;font-size:14px;color:#3d3d3d;">
                      ${info.Setor}
                    </div>
                    <div style="padding:18px 0;">
                      <div style="height:1px;border-bottom:1px solid #055441;"></div>
                    </div>
                    <div class="contatos">
                      <div class="linha-contato">${telefone}${celular ? ' | ' + celular : ''}</div>
                      <div class="linha-contato">${email}</div>
                      <div class="linha-contato"><a href="https://${site}">${site}</a></div>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          `;

          document.getElementById('assinatura').innerHTML = html;
          document.getElementById('copyBtn').style.display = 'inline-block';
        });
      });

    // 2) cópia rich-text para clipboard
    document.getElementById('copyBtn').addEventListener('click', async () => {
      const container = document.getElementById('assinatura');
      const html = container.innerHTML;
      const text = container.innerText;

      if (navigator.clipboard && navigator.clipboard.write) {
        try {
          const blobHtml = new Blob([html], { type: 'text/html' });
          const blobText = new Blob([text], { type: 'text/plain' });
          await navigator.clipboard.write([
            new ClipboardItem({ 'text/html': blobHtml, 'text/plain': blobText })
          ]);
          alert('Assinatura copiada como rich text! Cole no Gmail.');
          return;
        } catch (e) {
          console.warn('Clipboard API falhou, efetuando fallback');
        }
      }

      // fallback
      const range = document.createRange();
      range.selectNode(container);
      const sel = window.getSelection();
      sel.removeAllRanges();
      sel.addRange(range);
      document.execCommand('copy');
      sel.removeAllRanges();
      alert('Assinatura copiada! Cole no Gmail.');
    });
  </script>
</body>
</html>
